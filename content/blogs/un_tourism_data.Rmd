---
categories:  
- ""    #the front matter should be like the one found in, e.g., blog2.md. It cannot be like the normal Rmd we used
- ""
date: "2021-09-30"
description: UN Tourism Data # the title that will show up once someone gets to this page
draft: false
image: tourism.jpeg # save picture in \static\img\blogs. Acceptable formats= jpg, jpeg, or png . Your iPhone pics wont work

keywords: ""
slug: UN_Tourism_Data # slug is the shorthand URL address... no spaces plz
title: UN Tourism Data
---

```{r echo=FALSE, message=FALSE, load-libraries, warning=FALSE}
library(tidyverse)
library(data.table)
library(janitor)
library(wbstats)
library(countrycode)
library(skimr)
library(scales)
library(ggthemes)
```


## Data cleaning
```{r}
url <- "https://data.un.org/_Docs/SYB/CSV/SYB63_176_202003_Tourist-Visitors%20Arrival%20and%20Expenditure.csv"

un_tourism_data <- fread(input = url,
                         skip=1) %>% 
  clean_names() %>% 
  rename(country = v2) %>% 
  select(-c(1,5,6,8,9))


tourism_wide <-  un_tourism_data %>% 
    pivot_wider(names_from = "series",
              values_from = "value") %>% 
  clean_names() %>% 
  rename(
    tourism_expenditure = tourism_expenditure_millions_of_us_dollars ,
    tourist_arrivals = tourist_visitor_arrivals_thousands    
  )



tourism_wide <- tourism_wide %>% 
  filter(!is.na(tourism_expenditure), 
         !is.na(tourist_arrivals))


# create new variable that calculates spending per tourist
tourism_wide <- tourism_wide %>% 
  mutate(spending_per_tourist = 1000*tourism_expenditure/tourist_arrivals)



tourism_long <- tourism_wide %>% 
  pivot_longer(cols = 3:5, #columns 3 to 5
               names_to = "indicator",
               values_to = "value")

# Turn `indicator` from character to a factor variable
tourism_long <- tourism_long %>% 
  mutate(
    indicator = factor(indicator, 
                       levels = c("tourist_arrivals", "tourism_expenditure", "spending_per_tourist"),
                       labels = c("Tourist Arrivals (000s)", "Tourism Expenditure (million $)", "Spending per tourist($)"))
  )


```


## Explore the relationship between tourist arrivals and spending
### Apac region
```{r, tourist arrivals and spending}
tourism_long %>% 
  filter(country %in% c("Japan", "Australia", "Korea", "China, Hong Kong SAR", "Singapore", "China")) %>% 
  ggplot(aes(x=year, y = value, colour=country))+
  geom_line()+
  geom_point(size=0.5)+
  facet_grid(rows = vars(indicator),
             cols = vars(country), 
             scales = "free")+
  theme_bw()+
  theme(legend.position = "none")+
  scale_y_continuous(labels = scales::label_comma())+
  labs(
    title = "Tourist Arrivals and Spending",
    caption = "Source: UN",
    x = "",
    y = ""
  )
```

### Europe region

```{r, tourist arrivals and spending_1}
tourism_long %>% 
  filter(country %in% c("United Kingdom", "Austria", "France", "Germany", "Italy", "Spain")) %>% 
  ggplot(aes(x=year, y = value, colour=country))+
  geom_line()+
  geom_point(size=0.5)+
  facet_grid(rows = vars(indicator),
             cols = vars(country), 
             scales = "free")+
  theme_bw()+
  theme(legend.position = "none")+
  scale_y_continuous(labels = scales::label_comma())+
  labs(
    title = "Tourist Arrivals and Spending",
    caption = "Source: UN",
    x = "",
    y = ""
  )
```


# Calculate growth rates, starting for each country at 1 (or 100%)
```{r, calculate growth rates}
tourism_wide2 <- tourism_wide  %>% 
  group_by(country) %>%
  mutate(
    delta_arrivals = (tourist_arrivals / lag(tourist_arrivals,1)),
    delta_expenditure = (tourism_expenditure/lag(tourism_expenditure,1 )), 
    delta_spending_per_tourist = (spending_per_tourist/lag(spending_per_tourist,1))
  ) %>% 
  replace_na(list(
    delta_arrivals = 1,
    delta_expenditure = 1,
    delta_spending_per_tourist = 1
  )) %>% 
  ungroup() %>% 
  select(country, year, delta_arrivals, delta_expenditure, delta_spending_per_tourist)

# wide to long
tourism_long2 <- tourism_wide2 %>% 
  pivot_longer(cols = 3:5, #columns 3 to 5
               names_to = "indicator",
               values_to = "value")

```

## Plot % changes, with 1=100% as starting point for each country

```{r, plotchanges}
tourism_long2 %>% 
  filter(country %in% c("Japan", "Australia", "Korea", "China, Hong Kong SAR", "Singapore", "China","United Kingdom", "Austria", "France", "Germany", "Italy", "Spain")) %>% 
  ggplot(aes(x=year, y = value, colour=country))+
  geom_line()+
  geom_point(size=0.5)+
  facet_grid(rows = vars(indicator),
             cols = vars(country), 
             scales = "free")+
  theme_bw()+
  theme(legend.position = "none")+
  scale_y_continuous(labels = scales::label_percent())+
  labs(
    title = "Changes in Tourist Arrivals and Spending in Apac and Europe regions——taking 10 countries as examples",
    subtitle = "Base year (100%) = 1995",
    caption = "Source: UN",
    x = "",
    y = ""
  )

```




